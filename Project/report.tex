\documentclass[onecolumn,10pt]{jhwhw}

\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{color}
\usepackage{commath}
\usepackage{empheq}
\usepackage{epsfig}
\usepackage{framed}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{listings}
\usepackage{mathtools}
\usepackage{pdfpages}
\usepackage{pgfplots}
\usepackage{siunitx}
\usepackage{wrapfig}

% Command "alignedbox{}{}" for a box within an align environment
% Source: http://www.latex-community.org/forum/viewtopic.php?f=46&t=8144
\newlength\dlf  % Define a new measure, dlf
\newcommand\alignedbox[2]{
% Argument #1 = before & if there were no box (lhs)
% Argument #2 = after & if there were no box (rhs)
&  % Alignment sign of the line
{
\settowidth\dlf{$\displaystyle #1$}
    % The width of \dlf is the width of the lhs, with a displaystyle font
\addtolength\dlf{\fboxsep+\fboxrule}
    % Add to it the distance to the box, and the width of the line of the box
\hspace{-\dlf}
    % Move everything dlf units to the left, so that & #1 #2 is aligned under #1 & #2
\boxed{#1 #2}
    % Put a box around lhs and rhs
}
}
% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{12} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal

\def\du#1{\underline{\underline{#1}}}

\author{John Karasinski}
\title{Project}

\begin{document}
%\maketitle

\begin{enumerate}
  \item Introduction
    \begin{enumerate}
      \item What is it? Diagram!
    \end{enumerate}
  \item Finite Kinematic Analysis
    \begin{enumerate}
      \item Method 1: D-H Formulation
        \begin{enumerate}
          \item Derive kinematic equation using D-H matrices, present Table of D-H parameters
        \end{enumerate}
      \item Method 2: Derive Shape/Joint Matrices
        \begin{enumerate}
          \item Solution for the direct and inverse kinematic
        \end{enumerate}
      \item Numerical Example
    \end{enumerate}
  \item Differential Kinematic Analysis
    \begin{enumerate}
      \item Derive the Jacobian using two methods
      \item Write velocity equation
    \end{enumerate}
  \item Conclusions
  \item References
\end{enumerate}

\section{Introduction}
We're going to play with a shoulder roll locked SSRMS.

\section{Finite Kinematic Analysis}
\subsection{Denavit-Hartenberg Parameters}

\begin{table}[h]
\centering
\begin{tabular}{c|*{4}{c}}
\toprule
$i$ & $\theta_i$ & $\alpha_i$ & $a_i$ & $d_i$ \\
\midrule
1 & $\theta_1$ & 90 &     0 & $d_1$ \\
2 & $\theta_2$ & 90 &     0 & $d_2$ \\
3 & $\theta_3$ &  0 & $a_3$ & $d_3$ \\
4 & $\theta_4$ &  0 & $a_4$ &     0 \\
5 & $\theta_5$ & 90 &     0 &     0 \\
6 & $\theta_6$ & 90 &     0 & $d_6$ \\
7 & $\theta_7$ & 90 &     0 & $d_7$ \\
\bottomrule
\end{tabular}
\caption{The Denavit-Hartenberg parameters for the SSRMS. These parameters are the joint angle, $\theta$, the link twist angle, $\alpha$, the link length, $a$, and the joint offset, $d$.}
\end{table}
The resulting matrices are therefore
\begin{align*}
T_{01} &=
\left[\begin{matrix}\cos{\left (\theta_{1} \right )} & 0 & \sin{\left (\theta_{1} \right )} & 0\\\sin{\left (\theta_{1} \right )} & 0 & - \cos{\left (\theta_{1} \right )} & 0\\0 & 1 & 0 & d_{1}\\0 & 0 & 0 & 1\end{matrix}\right]
&&T_{12} =
\left[\begin{matrix}\cos{\left (\theta_{2} \right )} & 0 & \sin{\left (\theta_{2} \right )} & 0\\\sin{\left (\theta_{2} \right )} & 0 & - \cos{\left (\theta_{2} \right )} & 0\\0 & 1 & 0 & d_{2}\\0 & 0 & 0 & 1\end{matrix}\right] \\
T_{23} &=
\left[\begin{matrix}\cos{\left (\theta_{3} \right )} & - \sin{\left (\theta_{3} \right )} & 0 & a_{3} \cos{\left (\theta_{3} \right )}\\\sin{\left (\theta_{3} \right )} & \cos{\left (\theta_{3} \right )} & 0 & a_{3} \sin{\left (\theta_{3} \right )}\\0 & 0 & 1 & d_{3}\\0 & 0 & 0 & 1\end{matrix}\right]
&&T_{34} =
\left[\begin{matrix}\cos{\left (\theta_{4} \right )} & - \sin{\left (\theta_{4} \right )} & 0 & a_{4} \cos{\left (\theta_{4} \right )}\\\sin{\left (\theta_{4} \right )} & \cos{\left (\theta_{4} \right )} & 0 & a_{4} \sin{\left (\theta_{4} \right )}\\0 & 0 & 1 & 0\\0 & 0 & 0 & 1\end{matrix}\right] \\
T_{45} &=
\left[\begin{matrix}\cos{\left (\theta_{5} \right )} & 0 & \sin{\left (\theta_{5} \right )} & 0\\\sin{\left (\theta_{5} \right )} & 0 & - \cos{\left (\theta_{5} \right )} & 0\\0 & 1 & 0 & 0\\0 & 0 & 0 & 1\end{matrix}\right]
&&T_{56} =
\left[\begin{matrix}\cos{\left (\theta_{6} \right )} & 0 & \sin{\left (\theta_{6} \right )} & 0\\\sin{\left (\theta_{6} \right )} & 0 & - \cos{\left (\theta_{6} \right )} & 0\\0 & 1 & 0 & d_{6}\\0 & 0 & 0 & 1\end{matrix}\right] \\
T_{67} &=
\left[\begin{matrix}\cos{\left (\theta_{7} \right )} & 0 & \sin{\left (\theta_{7} \right )} & 0\\\sin{\left (\theta_{7} \right )} & 0 & - \cos{\left (\theta_{7} \right )} & 0\\0 & 1 & 0 & d_{7}\\0 & 0 & 0 & 1\end{matrix}\right]
\end{align*}


\subsection{Inverse Kinematics Solution}
In general we can define
\begin{align*}
T_{07} &=
\left[\begin{matrix}
n_x & o_x & a_x & p_x \\
n_y & o_y & a_y & p_y \\
n_z & o_z & a_z & p_z \\
  0 &   0 &   0 &   1 \\
\end{matrix}\right]\\
&= T_{01} T_{12} T_{23} T_{34} T_{45} T_{56} T_{67}
\end{align*}
Premultiplying both sides by $T_{01}^{-1}$ yields,
\begin{align*}
T_{01}^{-1} T_{07} = T_{12} T_{23} T_{34} T_{45} T_{56} T_{67}
\end{align*}
Equating each element $(i,j)$ on both the left and right hand sides yields:
\begin{align}
n_{x} c_1 + n_{y} s_1 &= \left(s_{2} s_{6} + c_{2} c_{6} c_{345}\right) c_{7} + s_{7} s_{345} c_{2} \label{eq1} \\
o_{x} c_1 + o_{y} s_1 &= - s_{2} c_{6} + s_{6} c_{2} c_{345} \label{eq5} \\
a_{x} c_1 + a_{y} s_1 &= \left(s_{2} s_{6} + c_{2} c_{6} c_{345}\right) s_{7} - s_{345} c_{2} c_{7} \label{eq7} \\
p_{x} c_1 + p_{y} s_1 &= a_{3} c_{2} c_{3} + a_{4} c_{2} c_{34} + d_{3} s_{2} + d_{6} s_{345} c_{2} - d_{7} s_{2} c_{6} + d_{7} s_{6} c_{2} c_{345} \label{eq3} \\
n_{z}                 &= \left(s_{2} c_{6} c_{345} - s_{6} c_{2}\right) c_{7} + s_{2} s_{7} s_{345} \label{eq2} \\
o_{z}                 &= s_{2} s_{6} c_{345} + c_{2} c_{6} \label{eq6} \\
a_{z}                 &= \left(s_{2} c_{6} c_{345} - s_{6} c_{2}\right) s_{7} - s_{2} s_{345} c_{7} \label{eq8} \\
- d_{1} + p_{z}       &= a_{3} s_{2} c_{3} + a_{4} s_{2} c_{34} - d_{3} c_{2} + d_{6} s_{2} s_{345} + d_{7} s_{2} s_{6} c_{345} + d_{7} c_{2} c_{6} \label{eq4} \\
n_{x} s_1 - n_{y} c_1 &= - s_{7} c_{345} + s_{345} c_{6} c_{7} \\
o_{x} s_1 - o_{y} c_1 &= s_{6} s_{345} \\
a_{x} s_1 - a_{y} c_1 &= s_{7} s_{345} c_{6} + c_{7} c_{345} \\
p_{x} s_1 - p_{y} c_1 &= a_{3} s_{3} + a_{4} s_{34} + d_{2} - d_{6} c_{345} + d_{7} s_{6} s_{345} \\
0                     &= 0 \\
0                     &= 0 \\
0                     &= 0 \\
1                     &= 1
\end{align}
where we have defined $s_i = \sin{i}, c_i = \cos{i}, s_{ij} = \sin{\left(i+j\right)}, c_{ij} = \cos{\left(i+j\right)}, s_{ijk} = \sin{\left(i+j+k\right)}$ and $c_{ijk} = \cos{\left(i+j+k\right)}$.

Manipulating the equations, we take $\left(Eq.~\ref{eq1} \right) s_2 - \left(Eq.~\ref{eq2} \right) c_2$ and simplify, producing
\begin{align}
\left(n_{x} c_1 + n_{y} s_1\right) s_2 - n_{z} c_2 &= s_{6} c_{7}
\end{align}
Similarly, we can do $\left(Eq.~\ref{eq3} \right) s_2-\left(Eq.~\ref{eq4}\right) c_2$ and simplify, which results in
\begin{align}
\left(p_{x} c_1 + p_{y} s_1 \right) s_2 - \left(- d_{1} + p_{z} \right) c_2 &= d_3 - c_6 d_7 \label{eqc1}
\end{align}
We can also subtract $\left(Eq.~\ref{eq6} \right) c_2 - \left(Eq.~\ref{eq5} \right) s_2$
\begin{align}
o_{z} c_2 - \left( o_{x} c_1 + o_{y} s_1 \right) s_2 &= c_{6} \label{eqc2}
\end{align}
Finally, we can also subtract $\left(Eq.~\ref{eq7} \right) s_2 - \left(Eq.~\ref{eq8} \right) c_2$
\begin{align}
\left(a_{x} c_1 + a_{y} s_1\right) s_2 - a_{z} c_2 &= s_{6} s_{7}
\end{align}

Rearranging Equations~\ref{eqc1} and \ref{eqc2} to be equal to $c_6$ and equating the two yields
\begin{align}
% \left(p_{x} c_1 + p_{y} s_1 \right) s_2 - \left(- d_{1} + p_{z} \right) c_2 &= d_3 - \left( o_{z} c_2 - \left( o_{x} c_1 + o_{y} s_1 \right) s_2 \right) d_7 \\
-d_3 &= \left( \left( o_{x} d_7 - p_{x} \right) c_1 + \left( o_{y} d_7 - p_{y} \right) s_1 \right) s_2 + \left(-o_{z} d_7 - d_{1} + p_{z} \right) c_2 
\end{align}

Locking the shoulder roll angle to a known angle, $\theta_1 = \beta$, we can solve for $\theta_2$,
\begin{align}
-d_3 &= \left( \left( o_{x} d_7 - p_{x} \right) c_1 + \left( o_{y} d_7 - p_{y} \right) s_1 \right) s_2 + \left(-o_{z} d_7 - d_{1} + p_{z} \right) c_2 
\end{align}

\nocite{*}
\bibliography{bib} 
\bibliographystyle{alpha}

\end{document}
